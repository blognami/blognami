<%

    model = create_model do
        must_not_be_blank :email
        must_be_a_valid_email :email
    end

    render_form(model, {
        title: 'Sign In',
        fields: [{ name: 'email', label: 'Your email', placeholder: "We'll send a one-time-password to this address." }],
        submit_title: 'Next',

        success: Proc.new do |model|
            email = model.email
            user = users.email_eq(email).first
            if user
                password = user.generate_password
                dispatch_email({ 
                    to: email,
                    subject: "Your one-time-password",
                    text: "Your one-time-password: \"#{password}\" - this will be valid for approximately 3 mins."
                })
            end
            span "data-decorator" => "pinstripe-anchor", "data-trigger" => "click", "data-href" => "/sign_in/verify_password?email=#{email}"
        end
    })

%>